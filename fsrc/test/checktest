#!/bin/bash

if [ ! $# -eq 2 ] ; then
	printf "Usage: checktest -w|--warning|-e|--error LOGFILE\n"
	exit 2
fi

LOGFILE="$2"

case "$1" in
	-w|--warning)
		if grep -i "warning" "$LOGFILE" | grep -viq "0\s*warning" ; then
			cat "$LOGFILE"
			grep -i "warning" "$LOGFILE" | grep -vi "0\s*warning"
		fi
		exit 0
		;;
	-e|--error)
		if grep -iq "error\|fail" "$LOGFILE" | grep -viq "0\s*error" ; then
			cat "$LOGFILE"
			grep -i "error\|fail" "$LOGFILE" | grep -vi "0\s*error"
			exit 1
		else
			exit 0
		fi
		;;
	*)
		exit 3
		;;
esac
